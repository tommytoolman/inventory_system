# Session Handoff — 2026-02-16

## What We Achieved

### 1. eBay Template: Conditional "Artist Owned" Badge
**Files:** `app/templates/ebay/listing_template.html`, `app/routes/inventory.py`

Products with `product.artist_owned = True` now display an "Artist Owned" badge in the eBay listing template, positioned to the left of the intro text and title in a flex row layout.

**Implementation:**
- Conditional Jinja2 block: artist-owned products get `.lvg-title-row` (flex container with badge + title); standard products render unchanged
- Badge image served via `artist_badge_url` context variable (currently `/static/ebay/artist_owned_1.png`)
- CSS `mix-blend-mode: multiply` on the badge image — this makes white/light pixels in the PNG invisible against the white wrapper background, solving the fake-checkerboard-transparency issue baked into the source PNGs
- Border-bottom (title underline) moved to `.lvg-title-row` so it spans the full width under both badge and title
- Title text stays centre-aligned (not left-aligned)
- Badge size: 193px desktop, 128px mobile
- Mobile responsive overrides in `@media (max-width: 600px)` block

**Badge images available:**
- `app/static/ebay/artist_owned_1.png` — electric guitar in laurel wreath (currently active)
- `app/static/ebay/artist_owned_2.png` — acoustic guitar in laurel wreath
- `app/static/ebay/artist_owned_3.png` — third variant
- `app/static/ebay/artist_owned_4.png` — fourth variant
- `app/static/ebay/artist_owned_1.jpeg` — JPEG variant

User generated new badge images externally; all stored in `app/static/ebay/`. To swap badge, change the filename in the route's `artist_badge_url` value.

### 2. eBay Template: Description Auto-Formatting
**File:** `app/routes/inventory.py` — `_clean_ebay_description_html()`

New corrective filter applied to product description HTML before rendering in the eBay template. Fixes common issues from Reverb/CMS imports without assuming all descriptions are broken — only corrects when issues are detected.

**What it fixes:**
1. **Fragmented bold tags** — `</strong>&nbsp;<strong>` merged into single `<strong>` span (e.g. `<strong>Year</strong>&nbsp;<strong>of</strong>&nbsp;<strong>manufacture</strong>` → `<strong>Year of manufacture</strong>`)
2. **Empty paragraphs** — `<p>&nbsp;</p>`, `<p></p>`, `<p> </p>` removed (these created unwanted double-space gaps)
3. **First paragraph bold** — if the first `<p>` isn't already wrapped in `<strong>`, it gets wrapped (product title line)
4. **EU footer divider** — `<hr>` with `2em` margin inserted before "ALL EU PURCHASES ARE DELIVERED WITH TAXES AND DUTIES PAID" block
5. **Whitespace collapse** — runs of whitespace between tags normalised

### 3. eBay Template: Typography Fixes
**File:** `app/templates/ebay/listing_template.html`

- **Bold font weight:** Google Fonts URL updated from `Open+Sans` to `Open+Sans:400,700` — the 700 weight was never loaded, so `<strong>` tags rendered without visible bold
- **Title text balancing:** Added `text-wrap: balance` to `.lvg-title` — prevents orphan words (single word on second line) by distributing words evenly across lines

### 4. Badge Generator Script
**File:** `scripts/generate_artist_badge.py`

Matplotlib script for generating badge PNGs with true transparency. Produces a star-ring border with "Artist Owned" text and electric guitar silhouette. Output to `app/static/ebay/`. Not used in production — was an experiment; user opted to create badge images externally instead.

## Commits
1. `c1a0d3e` — Add Artist Owned badge + description cleanup to eBay listing template
2. `b8308d5` — Adjust Artist Owned badge size to 193px

## Where to Pick Up Next

### eBay Template: Wiring Into Live Listings
The badge and description cleanup currently only work in the **preview route** (`ebay_template_preview`). To use them in actual eBay listings created via `create_listing_from_product()`:
- The `artist_badge_url` must be a **publicly accessible HTTPS URL** (Railway domain or base64-encoded data URI) — eBay won't load localhost paths
- The `_clean_ebay_description_html()` function should be called in `create_listing_from_product()` as well
- Consider making badge version (electric vs acoustic) configurable per product or based on category

### Badge Image Quality
The current PNGs have a fake checkerboard transparency pattern baked into the pixels (not true alpha). The `mix-blend-mode: multiply` CSS trick handles this on white backgrounds. If a proper transparent PNG is created in future, it will work even better (the multiply blend mode is harmless on truly transparent images).

### Remaining Items from todo.md
- Database schema constraints — need Alembic migration for NOT NULL on `platform_id` columns
- Shopify-only products image persistence — 18 Shopify products without RIFF records
- Category/platform attributes — item specifics in `spec_fields.py` needs testing
- Full code audit — technical debt review still pending
